<Window x:Class="ImageCullingTool.WPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ImageCullingTool.WPF"
        mc:Ignorable="d"
        Title="MainWindow" Height="450" Width="800">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="300"/>
            <!-- Left Panel -->
            <ColumnDefinition Width="5"/>
            <!-- Splitter -->
            <ColumnDefinition Width="*"/>
            <!-- Main View -->
            <ColumnDefinition Width="250"/>
            <!-- Right Panel -->
        </Grid.ColumnDefinitions>

        <!-- Left Panel: File Browser & Analysis -->
        <Border Grid.Column="0" Background="#F5F5F5" BorderBrush="#DDD" BorderThickness="0,0,1,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <!-- Folder Selection -->
                    <RowDefinition Height="Auto"/>
                    <!-- Analysis Controls -->
                    <RowDefinition Height="*"/>
                    <!-- File List -->
                    <RowDefinition Height="Auto"/>
                    <!-- Progress -->
                </Grid.RowDefinitions>

                <!-- Folder Selection -->
                <GroupBox Grid.Row="0" Header="Folder" Margin="5">
                    <StackPanel>
                        <Button Name="BtnSelectFolder" Content="Select Folder" Padding="5" Margin="5"
                                Click="BtnSelectFolder_Click"/>
                        <TextBlock Name="TxtCurrentFolder" Text="No folder selected" 
                                   TextWrapping="Wrap" Margin="5" FontSize="10" Foreground="Gray"/>
                        <TextBlock Name="TxtFolderStats" Text="" 
                                   TextWrapping="Wrap" Margin="5" FontSize="10"/>
                    </StackPanel>
                </GroupBox>

                <!-- Analysis Controls -->
                <GroupBox Grid.Row="1" Header="Analysis" Margin="5">
                    <StackPanel>
                        <Button Name="BtnAnalyzeAll" Content="Analyze All Images" Padding="5" Margin="5"
                                Click="BtnAnalyzeAll_Click" IsEnabled="False"/>
                        <Button Name="BtnAnalyzeSelected" Content="Analyze Selected" Padding="5" Margin="5"
                                Click="BtnAnalyzeSelected_Click" IsEnabled="False"/>
                        <Separator Margin="5"/>
                        <Button Name="BtnShowKeepers" Content="Show Keepers (4+ stars)" Padding="5" Margin="5"
                                Click="BtnShowKeepers_Click" IsEnabled="False"/>
                        <Button Name="BtnShowAll" Content="Show All Images" Padding="5" Margin="5"
                                Click="BtnShowAll_Click" IsEnabled="False"/>
                    </StackPanel>
                </GroupBox>

                <!-- File List -->
                <GroupBox Grid.Row="2" Header="Images" Margin="5">
                    <ListBox Name="LbImages" SelectionChanged="LbImages_SelectionChanged">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Margin="2">
                                    <!-- Status Indicator -->
                                    <Ellipse Width="8" Height="8" Margin="0,0,5,0" VerticalAlignment="Center">
                                        <Ellipse.Fill>
                                            <MultiBinding Converter="{StaticResource StatusColorConverter}">
                                                <Binding Path="AnalysisDate"/>
                                                <Binding Path="PredictedRating"/>
                                            </MultiBinding>
                                        </Ellipse.Fill>
                                    </Ellipse>

                                    <!-- Filename -->
                                    <TextBlock Text="{Binding Filename}" FontSize="11" VerticalAlignment="Center"/>

                                    <!-- Rating Stars (if analyzed) -->
                                    <TextBlock Margin="5,0,0,0" VerticalAlignment="Center" FontSize="10">
                                        <TextBlock.Text>
                                            <MultiBinding Converter="{StaticResource RatingStarsConverter}">
                                                <Binding Path="LightroomRating"/>
                                                <Binding Path="PredictedRating"/>
                                            </MultiBinding>
                                        </TextBlock.Text>
                                    </TextBlock>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </GroupBox>

                <!-- Progress -->
                <Border Grid.Row="3" Background="White" BorderBrush="#DDD" BorderThickness="0,1,0,0" Padding="5">
                    <StackPanel>
                        <TextBlock Name="TxtStatus" Text="Ready" FontWeight="Bold" FontSize="11"/>
                        <ProgressBar Name="ProgressBar" Height="15" Margin="0,3,0,0" 
                                     Visibility="Collapsed" Minimum="0" Maximum="100"/>
                        <TextBlock Name="TxtProgressDetail" Text="" FontSize="9" Foreground="Gray"/>
                        <Button Name="BtnCancel" Content="Cancel" Padding="5,2" Margin="0,3,0,0"
                                Visibility="Collapsed" Click="BtnCancel_Click"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- Splitter -->
        <GridSplitter Grid.Column="1" HorizontalAlignment="Stretch" Background="#DDD"/>

        <!-- Main View: Image Display -->
        <Border Grid.Column="2" Background="Black">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <!-- View Controls -->
                    <RowDefinition Height="*"/>
                    <!-- Image Display -->
                </Grid.RowDefinitions>

                <!-- View Controls -->
                <Border Grid.Row="0" Background="#333" Padding="10">
                    <StackPanel Orientation="Horizontal">
                        <Button Name="BtnZoomFit" Content="Fit to Window" Padding="8,4" Margin="0,0,10,0"
                                Click="BtnZoomFit_Click"/>
                        <Button Name="BtnZoom100" Content="100%" Padding="8,4" Margin="0,0,10,0"
                                Click="BtnZoom100_Click"/>

                        <Separator Margin="10,0"/>

                        <TextBlock Name="TxtImageInfo" Text="" Foreground="White" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <!-- Image Display with ZoomControl -->
                <zoom:ZoomControl Grid.Row="1" Name="ImageZoomControl" Background="Black"
                                  ZoomSensitivity="1.2" VerticalAlignment="Stretch" HorizontalAlignment="Stretch">
                    <Image Name="MainImage" Stretch="Uniform" RenderOptions.BitmapScalingMode="HighQuality"/>
                </zoom:ZoomControl>

                <!-- No Image Selected Overlay -->
                <Border Grid.Row="1" Name="NoImageOverlay" Background="Black" 
                        HorizontalAlignment="Center" VerticalAlignment="Center">
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                        <TextBlock Text="📷" FontSize="48" HorizontalAlignment="Center" Foreground="#666" Margin="0,0,0,10"/>
                        <TextBlock Text="Select an image from the list" 
                                   FontSize="16" Foreground="#999" HorizontalAlignment="Center"/>
                        <TextBlock Text="or choose a folder to begin" 
                                   FontSize="14" Foreground="#666" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- Right Panel: Image Details & Analysis -->
        <Border Grid.Column="3" Background="#F5F5F5" BorderBrush="#DDD" BorderThickness="1,0,0,0">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="5">

                    <!-- File Information -->
                    <GroupBox Header="File Info" Margin="0,0,0,10">
                        <StackPanel>
                            <TextBlock Name="TxtFileName" Text="" FontWeight="Bold" TextWrapping="Wrap"/>
                            <TextBlock Name="TxtFileSize" Text="" Margin="0,2,0,0"/>
                            <TextBlock Name="TxtFileDimensions" Text="" Margin="0,2,0,0"/>
                            <TextBlock Name="TxtFileFormat" Text="" Margin="0,2,0,0"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- Lightroom Data -->
                    <GroupBox Header="Lightroom" Margin="0,0,0,10">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Rating:" Width="60"/>
                                <TextBlock Name="TxtLrRating" Text=""/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                <TextBlock Text="Pick:" Width="60"/>
                                <TextBlock Name="TxtLrPick" Text=""/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                <TextBlock Text="Label:" Width="60"/>
                                <TextBlock Name="TxtLrLabel" Text=""/>
                            </StackPanel>
                        </StackPanel>
                    </GroupBox>

                    <!-- AI Analysis Results -->
                    <GroupBox Header="AI Analysis" Margin="0,0,0,10">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="AI Rating:" Width="80"/>
                                <TextBlock Name="TxtAiRating" Text="" FontWeight="Bold"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                <TextBlock Text="Sharpness:" Width="80"/>
                                <TextBlock Name="TxtSharpness" Text=""/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                <TextBlock Text="Subjects:" Width="80"/>
                                <TextBlock Name="TxtSubjects" Text=""/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                <TextBlock Text="Eyes Open:" Width="80"/>
                                <TextBlock Name="TxtEyesOpen" Text=""/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                <TextBlock Text="Confidence:" Width="80"/>
                                <TextBlock Name="TxtConfidence" Text=""/>
                            </StackPanel>
                            <TextBlock Name="TxtAnalyzed" Text="" Margin="0,5,0,0" FontSize="10" Foreground="Gray"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- Quick Actions -->
                    <GroupBox Header="Actions" Margin="0,0,0,10">
                        <StackPanel>
                            <Button Name="BtnAnalyzeThis" Content="Analyze This Image" Padding="5" Margin="0,0,0,5"
                                    Click="BtnAnalyzeThis_Click" IsEnabled="False"/>
                            <Button Name="BtnOpenInExplorer" Content="Open in Explorer" Padding="5" Margin="0,0,0,5"
                                    Click="BtnOpenInExplorer_Click" IsEnabled="False"/>
                            <Button Name="BtnOpenXmp" Content="View XMP File" Padding="5"
                                    Click="BtnOpenXmp_Click" IsEnabled="False"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- Extended Analysis Data -->
                    <GroupBox Header="Technical Details" Margin="0,0,0,10">
                        <TextBox Name="TxtExtendedData" Text="" IsReadOnly="True" 
                                 TextWrapping="Wrap" FontFamily="Consolas" FontSize="9"
                                 MaxHeight="200" VerticalScrollBarVisibility="Auto"/>
                    </GroupBox>

                </StackPanel>
            </ScrollViewer>
        </Border>
    </Grid>
</Window>